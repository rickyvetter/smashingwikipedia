<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smashing Wikipedia</title>
    <link rel="stylesheet" href="css/foundation.css" />
    <script src="js/vendor/modernizr.js"></script>
  </head>
  <body>
    
    <div class="row">
      <div class="large-12 columns">
        <h1>Smashing Wikipedia</h1>
      </div>
    </div>

    <div class="row">
      <div id="article" class="large-8 medium-8 small-12 columns">
      </div>
      <div id="article-list" class="large-4 medium-4 small-12 columns">
      	<a id="random-button" class="small button" href="#">Random!</a>
      </div>
    </div>


    

    <!-- <div data-magellan-expedition="fixed"> <dl class="sub-nav"> <dd data-magellan-arrival="build"><a href="#build">Build with HTML</a></dd> <dd data-magellan-arrival="js"><a href="#js">Arrival 2</a></dd> </dl> </div> -->
    
    <script src="js/vendor/jquery.js"></script>
    <script src="js/foundation.min.js"></script>
    <script>
      $(document).foundation();
    </script>
    <script>

    var articleTitle;

    $(document).ready(function(){
	    findRandomArticle();
    });

    $(document).ready(function(){
	    $.getJSON( "http://en.wikipedia.org/w/api.php?action=query&list=random&format=json&rnnamespace=0&rnlimit=5&callback=?", function( data ) {
	    		var items = [];
	    		$.each( data.query.random, function( key, article ) {
						items.push( "<li id='" + article.id + "' name='" + article.title + "'><a href='#" + article.title + "'>" + article.title + "</a></li>" );
					});

					$( "<ul/>", {
						"class": "article-list",
						html: items.join( "" )
					}).appendTo( "#article-list" );
	    });
    });

    function findRandomArticle()
    {
    	var title;
    	$.getJSON( "http://en.wikipedia.org/w/api.php?action=query&list=random&format=json&rnnamespace=0&rnlimit=1&callback=?", function( data ) {
	    		title = data.query.random[0]["title"];
	    		window.location.href = "#" + title;
	    		//getFirstParagraph();
	    });
	    return title;
    }

    function getFirstParagraph(title)
    {
    	$.getJSON( "http://en.wikipedia.org/w/api.php?action=query&prop=extracts&format=json&exlimit=10&exintro=&titles=" + title + "&callback=?", function( data ) {

  			var items = [];

  			//var content = data.parse.text["*"];
  			for (var key in data.query.pages) {
				    articleID = data.query.pages[key];
				    articleTitle = data.query.pages[key].title;
				    articleExtract = data.query.pages[key].extract;
				}
				var content = articleExtract;

				items.push( "<div id='title'><h1><a href='http://en.wikipedia.org/wiki/" + articleTitle + "' target='_blank'>" + articleTitle + "</a></h1></div>" );
				items.push( "<div id='text'>" + content + "<p><a href='http://en.wikipedia.org/wiki/" + articleTitle + "' target='_blank'>Read more on Wikipedia...</a></p></div><hr>" );

				$("#article").contents().remove();
				$( "<div/>", {"id": articleTitle, html: items.join( "" )}).appendTo( "#article" );
			});
    }

		function moveToArticle(title)
    {
			newLocation = "#" + title;
		}

    $('#random-button').click(function(){
			findRandomArticle();		
			return false;
		});

		$(window).on('hashchange', function() {
		  var hash = location.hash.substr(1);
		  getFirstParagraph(hash);
		  moveToArticle(hash);
		});


    
    </script>
  </body>
</html>