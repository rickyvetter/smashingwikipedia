<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smashing Wikipedia</title>
    <link rel="stylesheet" href="css/foundation.css" />
    <script src="js/vendor/modernizr.js"></script>
    <style>
    	.main{
    		margin-top:25px;
    	}
    </style>
  </head>
  <body>



  	<nav class="top-bar" data-topbar>
  	<ul class="title-area">
  			<li class="name">
  				<h1>
  					<a href="#">Smashing Wikipedia</a>
  				</h1>
  			</li>
  			<li class="toggle-topbar">
  				<a class="random-button button" href="#">Random!</a>
  			</li>
  		</ul>
  		<section class="top-bar-section">
  			<!-- Right Nav Section -->
  			<!-- <ul class="right">
  				<li class="active"><a href="#">Right Button Active</a></li>
  				<li class="has-dropdown">
  					<a href="#">Right Button Dropdown</a>
  					<ul class="dropdown">
  						<li><a href="#">First link in dropdown</a></li>
  					</ul>
  				</li> 
  			</ul>-->

  			<!-- Left Nav Section -->
  			<ul class="left">
  				<li><a>Smash count: <span id="smash">0</span></a></li>
  			</ul>
  		</section>
  	</nav>
    
    <div class="row main">
      <div id="main" class="large-8 medium-8 small-12 columns">
      	<div id="wiki-article">
      	</div>
      	<a class="random-button button expand" href="#">Smash a random article!</a>
      </div>
      <div id="article-list" class="large-4 medium-4 small-12 columns">
      	<p>Some carefully curated articles for your smashing enjoyment:</p>
      </div>
    </div>
    
    <script src="js/vendor/jquery.js"></script>
    <script src="js/foundation.min.js"></script>
    <script>
      $(document).foundation();
    </script>
    <script>

    var articleTitle;

    $(document).ready(function(){
	    findRandomArticle();
    });

    $(document).ready(function(){
	    $.getJSON( "http://en.wikipedia.org/w/api.php?action=query&list=random&format=json&rnnamespace=0&rnlimit=6&callback=?", function( data ) {
	    		var items = [];
	    		$.each( data.query.random, function( key, article ) {
						items.push( "<div class='large-12 medium-12 small-12 columns'><a href='#" + article.title + "' id='" + article.id + "' name='" + article.title + "' class='button secondary expand'>" + article.title + "</a></div>" );
					});

					$( "<div/>", {
						"class": "article-list",
						html: items.join( "" )
					}).appendTo( "#article-list" );
	    });
    });

    function findRandomArticle()
    {
    	var title;
    	$.getJSON( "http://en.wikipedia.org/w/api.php?action=query&list=random&format=json&rnnamespace=0&rnlimit=1&callback=?", function( data ) {
	    		title = data.query.random[0]["title"];
	    		window.location.href = "#" + title;
	    		//getFirstParagraph();
	    });
	    return title;
    }

    function getFirstParagraph(title)
    {
    	$.getJSON( "http://en.wikipedia.org/w/api.php?action=query&prop=extracts&format=json&exlimit=10&exintro=&titles=" + title + "&callback=?", function( data ) {

  			var items = [];

  			//var content = data.parse.text["*"];
  			for (var key in data.query.pages) {
				    articleID = data.query.pages[key];
				    articleTitle = data.query.pages[key].title;
				    articleExtract = data.query.pages[key].extract;
				}
				var content = articleExtract;

				items.push( "<div id='title'><h1><a href='http://en.wikipedia.org/wiki/" + articleTitle + "' target='_blank'>" + articleTitle + "</a></h1></div>" );
				items.push( "<div id='text'>" + content + "<p><a href='http://en.wikipedia.org/wiki/" + articleTitle + "' target='_blank'>Read more on Wikipedia...</a></p></div><hr>" );

				$("#wiki-article").contents().remove();
				$( "<div/>", {"id": articleTitle, html: items.join( "" )}).appendTo( "#wiki-article" );

				//add one to smash count
				smashCount = $("#smash").html();
				smashCount++;
				$('#smash').html(smashCount);
			});
    }

		function moveToArticle(title)
    {
			newLocation = "#" + title;
		}

    $('.random-button').click(function(){
			findRandomArticle();		
			//return false;
		});

		$(window).on('hashchange', function() {
		  var hash = location.hash.substr(1);
		  getFirstParagraph(hash);
		  moveToArticle(hash);
		});


    
    </script>
  </body>
</html>